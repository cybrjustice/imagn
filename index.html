<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Melody Auth Gateway Test</title>
</head>
<body>
  <button id="auth">Send Melody Auth</button>
  <pre id="auth-res"></pre>
  <button id="gen">Generate Image</button>
  <pre id="gen-res"></pre>
  <img id="img" style="max-width:400px; display:none;"/>

  <script>
    // Update this if your deployed endpoint changes:
    const API = "https://imagen.ai-n.workers.dev";
    const melody = ["C4","D4","E4","C4","D4","E4","C4","G4","D4"];

    document.getElementById("auth").onclick = async () => {
      document.getElementById("auth-res").textContent = "Sending...";
      const res = await fetch(API + "/auth/verify", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ attempt: melody })
      });
      document.getElementById("auth-res").textContent = await res.text();
    };

    document.getElementById("gen").onclick = async () => {
      document.getElementById("gen-res").textContent = "Requesting...";
      const res = await fetch(API + "/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({ type: "artwork", prompt: "cat" })
      });
      if (res.ok && res.headers.get("Content-Type") === "image/png") {
        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        document.getElementById("img").src = url;
        document.getElementById("img").style.display = '';
        document.getElementById("gen-res").textContent = "Success!";
      } else {
        document.getElementById("gen-res").textContent = await res.text();
        document.getElementById("img").style.display = 'none';
      }
    };
  </script>
</body>
</html>
